import{s as M,r as L,u as j,v as k,w as A,o as x,Q as K}from"./scheduler.8f106bd9.js";import{S as B,i as N,a as W,t as H}from"./index.4fbda23c.js";import{r as z}from"./index.eb2907c2.js";import{S as V,h as G,n as J,y as _,i as E,t as X,k as Y,r as C,b as T,z as Z,a as $,c as O,l as q}from"./IconButton.886b1b67.js";import{u as ee}from"./InitialFocus.183c7331.js";class te extends V{constructor(e,t){super(),this.client=e,this.options=t,this.trackedProps=[],this.previousSelectError=null,this.bindMethods(),this.setOptions(t)}bindMethods(){this.remove=this.remove.bind(this),this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.length===1&&(this.currentQuery.addObserver(this),F(this.currentQuery,this.options)&&this.executeFetch(),this.updateTimers())}onUnsubscribe(){this.listeners.length||this.destroy()}shouldFetchOnReconnect(){return ie(this.currentQuery,this.options)}shouldFetchOnWindowFocus(){return ne(this.currentQuery,this.options)}destroy(){this.listeners=[],this.clearTimers(),this.currentQuery.removeObserver(this)}setOptions(e,t){const r=this.options,i=this.currentQuery;if(this.options=this.client.defaultQueryObserverOptions(e),typeof this.options.enabled<"u"&&typeof this.options.enabled!="boolean")throw new Error("Expected enabled to be a boolean");this.options.queryKey||(this.options.queryKey=r.queryKey),this.updateQuery();const n=this.hasListeners();n&&U(this.currentQuery,i,this.options,r)&&this.executeFetch(),this.updateResult(t),n&&(this.currentQuery!==i||this.options.enabled!==r.enabled||this.options.staleTime!==r.staleTime)&&this.updateStaleTimeout();const u=this.computeRefetchInterval();n&&(this.currentQuery!==i||this.options.enabled!==r.enabled||u!==this.currentRefetchInterval)&&this.updateRefetchInterval(u)}updateOptions(e,t){const r=Object.assign(Object.assign({},this.options),e);e.queryKey&&!e.queryHash&&e.queryKey!==this.options.queryKey&&(r.queryHash=G(e.queryKey,r)),this.setOptions(r,t)}getOptimisticResult(e){const t=this.client.defaultQueryObserverOptions(e),r=this.client.getQueryCache().build(this.client,t);return this.createResult(r,t)}getCurrentResult(){return this.currentResult}trackResult(e,t){const r={},i=n=>{this.trackedProps.includes(n)||this.trackedProps.push(n)};return Object.keys(e).forEach(n=>{Object.defineProperty(r,n,{configurable:!1,enumerable:!0,get:()=>(i(n),e[n])})}),(t.useErrorBoundary||t.suspense)&&i("error"),r}getNextResult(e){return new Promise((t,r)=>{const i=this.subscribe(n=>{n.isFetching||(i(),n.isError&&(e!=null&&e.throwOnError)?r(n.error):t(n))})})}getCurrentQuery(){return this.currentQuery}remove(){this.client.getQueryCache().remove(this.currentQuery)}refetch(e){return this.fetch(Object.assign(Object.assign({},e),{meta:{refetchPage:e==null?void 0:e.refetchPage}}))}fetchOptimistic(e){const t=this.client.defaultQueryObserverOptions(e),r=this.client.getQueryCache().build(this.client,t);return r.fetch().then(()=>this.createResult(r,t))}fetch(e){return this.executeFetch(e).then(()=>(this.updateResult(),this.currentResult))}executeFetch(e){this.updateQuery();let t=this.currentQuery.fetch(this.options,e);return e!=null&&e.throwOnError||(t=t.catch(J)),t}updateStaleTimeout(){if(this.clearStaleTimeout(),_||this.currentResult.isStale||!E(this.options.staleTime))return;const t=X(this.currentResult.dataUpdatedAt,this.options.staleTime)+1;this.staleTimeoutId=setTimeout(()=>{this.currentResult.isStale||this.updateResult()},t)}computeRefetchInterval(){var e;return typeof this.options.refetchInterval=="function"?this.options.refetchInterval(this.currentResult.data,this.currentQuery):(e=this.options.refetchInterval)!==null&&e!==void 0?e:!1}updateRefetchInterval(e){this.clearRefetchInterval(),this.currentRefetchInterval=e,!(_||this.options.enabled===!1||!E(this.currentRefetchInterval)||this.currentRefetchInterval===0)&&(this.refetchIntervalId=setInterval(()=>{(this.options.refetchIntervalInBackground||Y.isFocused())&&this.executeFetch()},this.currentRefetchInterval))}updateTimers(){this.updateStaleTimeout(),this.updateRefetchInterval(this.computeRefetchInterval())}clearTimers(){this.clearStaleTimeout(),this.clearRefetchInterval()}clearStaleTimeout(){clearTimeout(this.staleTimeoutId),this.staleTimeoutId=void 0}clearRefetchInterval(){clearInterval(this.refetchIntervalId),this.refetchIntervalId=void 0}createResult(e,t){var r;const i=this.currentQuery,n=this.options,u=this.currentResult,c=this.currentResultState,p=this.currentResultOptions,d=e!==i,l=d?e.state:this.currentQueryInitialState,a=d?this.currentResult:this.previousQueryResult,{state:f}=e;let{dataUpdatedAt:R,error:b,errorUpdatedAt:v,isFetching:Q,status:o}=f,S=!1,I=!1,y;if(t.optimisticResults){const h=this.hasListeners(),m=!h&&F(e,t),D=h&&U(e,i,t,n);(m||D)&&(Q=!0,R||(o="loading"))}if(t.keepPreviousData&&!f.dataUpdateCount&&(a!=null&&a.isSuccess)&&o!=="error")y=a.data,R=a.dataUpdatedAt,o=a.status,S=!0;else if(t.select&&typeof f.data<"u")if(u&&f.data===(c==null?void 0:c.data)&&t.select===((r=this.previousSelect)===null||r===void 0?void 0:r.fn)&&!this.previousSelectError)y=this.previousSelect.result;else try{y=t.select(f.data),t.structuralSharing!==!1&&(y=C(u==null?void 0:u.data,y)),this.previousSelect={fn:t.select,result:y},this.previousSelectError=null}catch(h){T().error(h),b=h,this.previousSelectError=h,v=Date.now(),o="error"}else y=f.data;if(typeof t.placeholderData<"u"&&typeof y>"u"&&(o==="loading"||o==="idle")){let h;if(u!=null&&u.isPlaceholderData&&t.placeholderData===(p==null?void 0:p.placeholderData))h=u.data;else if(h=typeof t.placeholderData=="function"?t.placeholderData():t.placeholderData,t.select&&typeof h<"u")try{h=t.select(h),t.structuralSharing!==!1&&(h=C(u==null?void 0:u.data,h)),this.previousSelectError=null}catch(m){T().error(m),b=m,this.previousSelectError=m,v=Date.now(),o="error"}typeof h<"u"&&(o="success",y=h,I=!0)}return{status:o,isLoading:o==="loading",isSuccess:o==="success",isError:o==="error",isIdle:o==="idle",data:y,dataUpdatedAt:R,error:b,errorUpdatedAt:v,failureCount:f.fetchFailureCount,isFetched:f.dataUpdateCount>0||f.errorUpdateCount>0,isFetchedAfterMount:f.dataUpdateCount>l.dataUpdateCount||f.errorUpdateCount>l.errorUpdateCount,isFetching:Q,isRefetching:Q&&o!=="loading",isLoadingError:o==="error"&&f.dataUpdatedAt===0,isPlaceholderData:I,isPreviousData:S,isRefetchError:o==="error"&&f.dataUpdatedAt!==0,isStale:g(e,t),refetch:this.refetch,remove:this.remove}}shouldNotifyListeners(e,t){if(!t)return!0;const{notifyOnChangeProps:r,notifyOnChangePropsExclusions:i}=this.options;if(!r&&!i||r==="tracked"&&!this.trackedProps.length)return!0;const n=r==="tracked"?this.trackedProps:r;return Object.keys(e).some(u=>{const c=u,p=e[c]!==t[c],d=n==null?void 0:n.some(a=>a===u),l=i==null?void 0:i.some(a=>a===u);return p&&!l&&(!n||d)})}updateResult(e){const t=this.currentResult;if(this.currentResult=this.createResult(this.currentQuery,this.options),this.currentResultState=this.currentQuery.state,this.currentResultOptions=this.options,Z(this.currentResult,t))return;const r={cache:!0};(e==null?void 0:e.listeners)!==!1&&this.shouldNotifyListeners(this.currentResult,t)&&(r.listeners=!0),this.notify(Object.assign(Object.assign({},r),e))}updateQuery(){const e=this.client.getQueryCache().build(this.client,this.options);if(e===this.currentQuery)return;const t=this.currentQuery;this.currentQuery=e,this.currentQueryInitialState=e.state,this.previousQueryResult=this.currentResult,this.hasListeners()&&(t==null||t.removeObserver(this),e.addObserver(this))}onQueryUpdate(e){const t={};e.type==="success"?t.onSuccess=!0:e.type==="error"&&!$(e.error)&&(t.onError=!0),this.updateResult(t),this.hasListeners()&&this.updateTimers()}notify(e){O.batch(()=>{var t,r,i,n,u,c,p,d;e.onSuccess?((r=(t=this.options).onSuccess)===null||r===void 0||r.call(t,this.currentResult.data),(n=(i=this.options).onSettled)===null||n===void 0||n.call(i,this.currentResult.data,null)):e.onError&&((c=(u=this.options).onError)===null||c===void 0||c.call(u,this.currentResult.error),(d=(p=this.options).onSettled)===null||d===void 0||d.call(p,void 0,this.currentResult.error)),e.listeners&&this.listeners.forEach(l=>{l(this.currentResult)}),e.cache&&this.client.getQueryCache().notify({query:this.currentQuery,type:"observerResultsUpdated"})})}}function re(s,e){return e.enabled!==!1&&!s.state.dataUpdatedAt&&!(s.state.status==="error"&&e.retryOnMount===!1)}function se(s,e){return e.enabled!==!1&&s.state.dataUpdatedAt>0&&(e.refetchOnMount==="always"||e.refetchOnMount!==!1&&g(s,e))}function F(s,e){return re(s,e)||se(s,e)}function ie(s,e){return e.enabled!==!1&&(e.refetchOnReconnect==="always"||e.refetchOnReconnect!==!1&&g(s,e))}function ne(s,e){return e.enabled!==!1&&(e.refetchOnWindowFocus==="always"||e.refetchOnWindowFocus!==!1&&g(s,e))}function U(s,e,t,r){return t.enabled!==!1&&(s!==e||r.enabled===!1)&&(!t.suspense||s.state.status!=="error")&&g(s,t)}function g(s,e){return s.isStaleByTime(e.staleTime)}function w(s){return s.optimisticResults=!0,s.onError&&(s.onError=O.batchCalls(s.onError)),s.onSuccess&&(s.onSuccess=O.batchCalls(s.onSuccess)),s.onSettled&&(s.onSettled=O.batchCalls(s.onSettled)),s}function ue(s,e,t){const r=q(s,e,t),i=ee();let n=i.defaultQueryObserverOptions(r);n=w(n);const u=new te(i,n),{subscribe:c}=z(u.getCurrentResult(),a=>u.subscribe(O.batchCalls(a)));u.updateResult();function p(a,f,R){const b=q(a,f,R);let v=i.defaultQueryObserverOptions(b);v=w(v),u.hasListeners()&&u.setOptions(v,{listeners:!1})}function d(a){u.updateOptions(a)}function l(a){d({enabled:a})}return{subscribe:c,setOptions:p,updateOptions:d,setEnabled:l}}const ae=s=>({queryResult:s&1}),P=s=>({queryResult:s[0]});function le(s){let e;const t=s[6].query,r=L(t,s,s[5],P);return{c(){r&&r.c()},l(i){r&&r.l(i)},m(i,n){r&&r.m(i,n),e=!0},p(i,[n]){r&&r.p&&(!e||n&33)&&j(r,t,i,i[5],e?A(t,i[5],n,ae):k(i[5]),P)},i(i){e||(W(r,i),e=!0)},o(i){H(r,i),e=!1},d(i){r&&r.d(i)}}}function ce(s,e,t){let r,{$$slots:i={},$$scope:n}=e,{options:u}=e,{queryResult:c=void 0}=e,p=!0;x(()=>{t(3,p=!1)});const d=ue(u);return K(s,d,l=>t(4,r=l)),s.$$set=l=>{"options"in l&&t(2,u=l.options),"queryResult"in l&&t(0,c=l.queryResult),"$$scope"in l&&t(5,n=l.$$scope)},s.$$.update=()=>{s.$$.dirty&16&&t(0,c=r),s.$$.dirty&12&&(p||d.setOptions(u))},[c,d,u,p,r,n,i]}class oe extends B{constructor(e){super(),N(this,e,ce,le,M,{options:2,queryResult:0})}}const Re=oe;export{Re as Q};
